import pandas as pd
import numpy as np
import json
from geopy.distance import geodesic

# Load pintail track
track = pd.read_csv("radar_pintail_track.csv")
track_points = track[['lat', 'lon']].to_numpy()

# cumulative distance along track
cum_dist = [0]
for i in range(1, len(track_points)):
    d = geodesic(track_points[i-1], track_points[i]).meters
    cum_dist.append(cum_dist[-1] + d)
cum_dist = np.array(cum_dist)

# Cable parameters
total_length = 1920
dx = 3.19
cable_distances = np.arange(0, total_length, dx)

# Interpolate cable points along track
cable_lats, cable_lons = [], []
for d in cable_distances:
    idx = np.searchsorted(cum_dist, d) - 1
    idx = max(0, min(idx, len(cum_dist)-2))
    frac = (d - cum_dist[idx]) / (cum_dist[idx+1] - cum_dist[idx])
    lat = track_points[idx][0] + frac * (track_points[idx+1][0] - track_points[idx][0])
    lon = track_points[idx][1] + frac * (track_points[idx+1][1] - track_points[idx][1])
    cable_lats.append(lat)
    cable_lons.append(lon)

cable_coords = list(zip(cable_lats, cable_lons))

# Save JSON
with open("cable_coords.json", "w") as f:
    json.dump(cable_coords, f)
